# 権限管理・ロール定義

## 概要

システム内の各ユーザーロールと権限レベル、アクセス制御ルールを詳細に定義します。企業アカウント・グループ構成における複雑な権限管理を含みます。

## 5. 権限管理

### 5.1. ユーザーロール一覧

#### 候補者 (Candidate)
- **概要**: 求職活動を行う個人ユーザー
- **基本権限**: 自身のプロフィール管理、求人検索・応募、企業とのメッセージ送受信
- **制限事項**: 他の候補者情報へのアクセス不可、企業の内部情報へのアクセス不可

#### 企業ユーザー - スカウト担当者 (Company User - Scout Staff)
- **概要**: 企業グループ内で採用活動を担当するユーザー
- **基本権限**: 候補者検索・スカウト送信、メッセージ送受信、求人作成・編集、採用進捗管理
- **制限事項**: 企業アカウント・グループの管理権限なし、他グループの情報アクセス制限

#### 企業ユーザー - 管理者 (Company User - Administrator)
- **概要**: 企業グループ内の管理権限を持つユーザー
- **基本権限**: スカウト担当者の全権限 + グループ管理、メンバー管理、企業アカウント情報編集
- **制限事項**: 所属していないグループの管理不可、自身のアカウント削除・権限変更不可

#### システム管理者 (System Administrator)
- **概要**: システム全体の運営・管理を行うユーザー
- **基本権限**: 全データへのアクセス、全機能の利用、ユーザー管理、コンテンツ管理、分析機能
- **制限事項**: なし（最高権限）

### 5.2. 企業ユーザーロール詳細

#### 5.2.1. スカウト担当者権限

**利用可能機能:**
- **候補者関連**:
  - 候補者検索・一覧表示・絞り込み・並び替え
  - 候補者詳細情報閲覧（氏名・電話番号は応募/スカウト返信後のみ）
  - 候補者ピックアップ・非表示リスト管理
  - 検索条件の保存・管理
- **スカウト・メッセージ**:
  - スカウト送信（チケット消費）
  - メッセージ送受信
  - スカウト・メッセージテンプレート作成・編集・削除
  - テンプレート内関数呼び出し利用
- **求人管理**:
  - 求人作成・編集・削除（所属グループのみ）
  - 求人掲載申請
  - 求人公開範囲設定
  - 求人一覧・絞り込み
- **採用進捗管理**:
  - 採用進捗一覧・絞り込み・並び替え
  - 候補者毎進捗・社内メモ管理
  - 選考ステータス更新
  - 面接日程登録
- **設定・その他**:
  - 自身のプロフィール編集（名前・役職名）
  - ログイン情報変更（メールアドレス・パスワード）
  - 通知メール配信設定
  - スカウトチケット残数確認

**アクセス制限:**
- 所属していない企業グループの情報は閲覧・操作不可
- 企業アカウント情報の編集不可
- 企業グループの作成・編集・削除不可
- 他メンバーの招待・権限変更・削除不可
- 他メンバーのプロフィール・設定編集不可

#### 5.2.2. 管理者権限

**利用可能機能:**
- **スカウト担当者の全権限**
- **企業アカウント管理**:
  - 企業アカウント情報編集
  - 企業アカウント設定変更
- **企業グループ管理**:
  - 企業グループ作成・編集（2つ目以降）
  - 企業グループ名変更
- **メンバー管理**:
  - メンバー招待（メールアドレス・権限指定）
  - メンバー権限変更（管理者⇔スカウト担当者）
  - メンバー削除
  - 招待メール再送信
- **高度な設定**:
  - 企業グループ別スカウトチケット管理
  - 契約プラン情報確認

**アクセス制限:**
- 自身のアカウント削除不可
- 自身の権限変更不可（他の管理者による変更は可能）
- 所属していない企業グループの管理不可
- 企業アカウントの削除不可（システム管理者のみ）
- 企業グループの削除不可（システム管理者のみ）

### 5.3. 企業アカウント・グループ構成ルール

#### 5.3.1. 基本構造ルール

**企業アカウント (Company Account)**
- 1つの企業につき1つの企業アカウント
- 企業アカウント作成は**システム管理者のみ**
- 企業アカウント削除は**システム管理者のみ**
- 企業アカウント内に複数の企業グループを作成可能

**企業グループ (Company Group)**
- 企業アカウント内の部署・チーム・ブランド等の単位
- 1つ目の企業グループ作成は**システム管理者のみ**
- 2つ目以降の企業グループ作成は**管理者権限ユーザーまたはシステム管理者**
- 企業グループ削除は**システム管理者のみ**

**企業ユーザー (Company User)**
- 1つの企業アカウント内の複数企業グループに所属可能
- 複数の企業アカウントに所属することは**不可能**
- 企業グループごとに権限レベルを設定（管理者 or スカウト担当者）

#### 5.3.2. メンバー招待・参加ルール

**初回招待（企業アカウント立ち上げ時）**
- 1つ目の企業グループへの1人目の招待は**システム管理者のみ**
- 初回招待されたユーザーは自動的に**管理者権限**が付与される

**通常招待**
- 2人目以降の招待は**管理者権限ユーザーまたはシステム管理者**
- 招待時に権限レベル（管理者 or スカウト担当者）を指定
- 招待メールにはグループ参加用の専用URLを含む

**参加プロセス**
- **未登録ユーザー**: 招待URL → 認証コード入力 → 名前・パスワード登録 → 参加完了
- **同一企業アカウント内の既存ユーザー**: 招待URL → 直接参加完了
- **他企業アカウントのユーザー**: 参加不可（1つの企業アカウントのみ所属可能）

#### 5.3.3. 権限変更・削除ルール

**権限変更**
- 管理者権限ユーザーは同じグループ内の他メンバーの権限を変更可能
- 自分自身の権限変更は不可
- システム管理者は全ての権限変更が可能

**メンバー削除**
- 管理者権限ユーザーは同じグループ内の他メンバーを削除可能
- 自分自身の削除は不可
- **企業グループ内に最低1人以上の管理者権限ユーザーが必要**
- 最後の管理者を削除する場合は、事前に他のメンバーを管理者に昇格させる必要がある

### 5.4. データアクセス権限マトリックス

#### 5.4.1. 候補者データアクセス

| データ種別 | 候補者本人 | スカウト担当者 | 管理者 | システム管理者 |
|------------|------------|----------------|--------|----------------|
| 基本情報（氏名・電話番号以外） | 読み書き | 読み取り | 読み取り | 読み書き |
| 氏名・電話番号 | 読み書き | 条件付き読み取り※1 | 条件付き読み取り※1 | 読み書き |
| 職務経歴・スキル | 読み書き | 読み取り | 読み取り | 読み書き |
| 希望条件 | 読み書き | 読み取り | 読み取り | 読み書き |
| アップロード書類 | 読み書き | 読み取り | 読み取り | 読み書き |
| メッセージ履歴 | 読み書き | 関連分のみ読み書き | 関連分のみ読み書き | 全て読み取り |
| 選考状況（他社） | 読み書き | 同意時のみ読み取り | 同意時のみ読み取り | 読み取り |
| 活動ログ | 読み取り | アクセス不可 | アクセス不可 | 読み取り |

※1 応募またはスカウト返信があった場合のみ閲覧可能

#### 5.4.2. 企業データアクセス

| データ種別 | スカウト担当者 | 管理者 | システム管理者 |
|------------|----------------|--------|----------------|
| 企業アカウント基本情報 | 読み取り | 読み書き | 読み書き |
| 所属グループ情報 | 読み取り | 読み書き | 読み書き |
| 他グループ情報 | アクセス不可 | アクセス不可 | 読み書き |
| メンバー情報（同じグループ） | 読み取り | 読み書き | 読み書き |
| メンバー情報（他グループ） | アクセス不可 | アクセス不可 | 読み書き |
| 求人情報（同じグループ） | 読み書き | 読み書き | 読み書き |
| 求人情報（他グループ） | アクセス不可 | アクセス不可 | 読み書き |
| スカウトチケット | 残数確認のみ | 残数確認のみ | 読み書き |
| 採用進捗（同じグループ） | 読み書き | 読み書き | 読み書き |
| 採用進捗（他グループ） | アクセス不可 | アクセス不可 | 読み書き |

#### 5.4.3. システム設定・管理データアクセス

| データ種別 | 企業ユーザー | システム管理者 |
|------------|--------------|----------------|
| NGキーワード設定 | アクセス不可 | 読み書き |
| メディア記事・カテゴリー・タグ | 読み取り | 読み書き |
| お知らせ | 読み取り | 読み書き |
| システム分析データ | アクセス不可 | 読み取り |
| ユーザー活動ログ | アクセス不可 | 読み取り |
| メール配信履歴 | アクセス不可 | 読み取り |

### 5.5. 機能アクセス制御

#### 5.5.1. 候補者機能制御

**スカウト受け取り停止時の制限**
- 企業側の候補者検索結果に非表示
- 企業からのスカウト送信不可
- 既存のメッセージ送受信は継続可能
- 求人応募は通常通り可能

**ブロック企業設定時の制限**
- ブロック企業からの候補者情報閲覧不可
- ブロック企業からのスカウト送信不可
- 候補者側からのブロック企業求人閲覧・応募は可能
- 応募を起点とした企業側からの候補者情報閲覧は可能

#### 5.5.2. 企業機能制御

**休会ステータス時の制限**
- **利用可能**: ログイン、企業アカウント情報編集、候補者検索、通知・おすすめ候補者表示
- **利用不可**: スカウト送信、メッセージ送信、求人作成・編集、新規メンバー招待、その他外部ユーザーに影響する操作

**スカウトチケット不足時の制限**
- スカウト送信時にチケット不足モーダル表示
- スカウト送信処理の実行不可
- 他の機能は通常通り利用可能

#### 5.5.3. システム管理機能制御

**求人掲載申請の承認フロー**
- 企業が求人作成・掲載申請 → システム管理者が審査 → 承認/非承認
- 承認まで求人は非公開状態
- 非承認時は理由とともに企業に通知

**NGワードメッセージの承認フロー**
- NGワード検出 → 自動で審査待ちステータス → システム管理者が審査 → 承認/却下
- 同一企業・候補者ペアでの初回承認後は以降自動承認
- 却下時は送信者に理由とともに通知

### 5.6. セキュリティ・監査

#### 5.6.1. アクセスログ記録

**記録対象操作**
- ログイン・ログアウト
- 候補者情報の閲覧・編集
- 求人情報の作成・編集・削除
- スカウト・メッセージの送信
- 権限変更・メンバー管理操作
- システム設定変更

**記録項目**
- 実行日時
- 実行ユーザー（ID・名前・権限レベル）
- 操作種別
- 対象データ（候補者ID、求人IDなど）
- IPアドレス
- ユーザーエージェント

#### 5.6.2. 権限エスカレーション防止

**権限昇格の制限**
- ユーザーは自分自身の権限を変更不可
- 管理者権限の付与は既存の管理者またはシステム管理者のみ
- システム管理者権限の付与はシステム側での直接操作のみ

**横断的アクセスの防止**
- 企業ユーザーは所属していない企業グループのデータにアクセス不可
- 候補者は他の候補者のデータにアクセス不可
- APIレベルでの権限チェック実装

#### 5.6.3. データ保護

**個人情報保護**
- 候補者の氏名・電話番号は条件を満たすまで非表示
- 退会した候補者情報は9ヶ月後に自動削除
- 管理者による候補者情報編集は履歴として記録

**企業情報保護**
- 企業の社内メモは候補者から閲覧不可
- 企業グループ間での情報隔離
- スカウトチケット情報の適切な管理

## 関連ドキュメント

- [候補者向け機能詳細](./01_candidate_features.md)
- [企業向け機能詳細](./02_company_features.md)
- [管理者向け機能詳細](./03_admin_features.md)
- [データ要件](./04_data_requirements.md)
- [通知機能](./06_notifications.md) 