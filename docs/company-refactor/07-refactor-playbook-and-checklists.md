# リファクタリング実践プレイブックとチェックリスト

## 1. 進め方（1ユースケース=1PR）

1) 追加のみの共通ファイルを作成
2) 対象ファイルの import を共通実装へ差し替え
3) 型エラーを解消（命名/責務見直しはここで最小限）
4) `pnpm build` → ローカル確認 → 主要フローの手動テスト
5) PR作成（影響箇所/確認手順/ロールバック方法を記載）

## 2. 変更ポリシー

- DOM/クラス/文言/URL は変えない
- 例外時のユーザー表示も従来踏襲（内部ログは改善可）
- サーバーアクションのレスポンスは Ok/Fail に統一

## 3. チェックリスト（PRごと）

- [ ] UI差分がゼロか（目視/スクショ）
- [ ] `pnpm build` が通るか（型エラー/ESLintなし）
- [ ] revalidate の対象パス過不足なし
- [ ] Env 参照の存在チェックを保持
- [ ] RLS/権限の境界での検証が担保されている
- [ ] ログに機密情報を出していない
- [ ] ドキュメント更新（該当章への追記）

## 4. よくある論点と判断基準

- 変換関数の置き場所: UI都合の変換は UI 層、ドメインの変換は lib/company
- 入力バリデーション: actions 入口で完結（UI側は最小限）
- ネーミング: 既存に合わせる。新規は動詞/名詞の原則に従う

## 5. サンプルPRの骨子

- タイトル: feat(company): centralize permission mapping and sendgrid mailer
- 変更: 新規ファイル追加、参照差し替え、レスポンス統一
- 確認: グループ招待/権限変更/削除、アカウント表示の回帰
- ロールバック: import を従来に戻すだけで可

---

次章: 移行計画とPR分割（09-migration-plan-and-prs.md）


