# リスクとロールバック戦略

## 1. リスク一覧と対策

- 型集中化によるエラー拡散
  - 小 PR 分割、対象ディレクトリ単位で完結
- 認可ロジックの副作用
  - 既存条件式を保持、共通関数は薄い委譲から開始
- メール送信共通化の障害
  - Env 存在チェック、障害時はログのみで継続（ユーザー文言は変更しない）
- revalidate の過不足
  - 集約関数内の対象パスを明文化、レビュー時に差分確認

## 2. ロールバック方針

- 追加のみ PR: そのまま保持可能（未参照なら無害）
- 参照切替 PR: import を元に戻す 1 commit で即時復旧
- 機能単位のフラグ管理は導入しない（UI 不変のため）

## 3. インシデント対応

- 例外時は従前のユーザー文言を維持（ユーザー影響最小化）
- 内部ログで原因特定を容易に（stack/params 最小限）
- 影響範囲の限定: RLS/グループ ID/会社アカウント ID でクエリを絞る

---

以上で拡張版の計画書のセットは完了です。各章の内容に従い、小さく安全に進めます。
