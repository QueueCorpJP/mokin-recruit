# candidate 配下リファクタリング診断・設計書（第 5 部：メディア・ニュース・メッセージ・タスク・設定）

---

## 1. カテゴリ概要

この部では
、`/candidate/media/`・`/candidate/news/`・`/candidate/message/`・`/candidate/task/`・`/candidate/setting/`配
下の**メディア・ニュース・メッセージ・タスク・設定**に関する全ページ・ロジックを徹底的に精査し、**リ
ファクタリング必須箇所とその理由・改善案**を厳密に記述します。

---

## 2. メディア

### 2.1 対象ファイル

- `media/page.tsx`
- `media/[media_id]/MediaDetailClient.tsx`
- `media/actions.ts`

### 2.2 主な問題点・リファクタリング推奨理由

#### a. 記事一覧・フィルタ・ページネーション・タグ管理ロジックの肥大化

- **現状**：状態管理・UI 描画・イベントハンドラが密結合。
- **理由**：保守性・テスト容易性・UX の低下。
- **改善案**：
  - ロジック分離（カスタムフック化）、UI 部品共通化、型の一元化。

#### b. サイドバー・関連記事・新着記事管理ロジックの肥大化

- **現状**：props/型の一貫性不足、UI 部品の重複。
- **理由**：UI 一貫性・保守性の低下。
- **改善案**：
  - ロジック分離・UI 部品共通化。

#### c. サーバーアクションの重複

- **現状**：記事/カテゴリ/タグ/サイドバー/関連記事取得の CRUD ロジックが他アクションと重複。エラーハ
  ンドリングの粒度不足。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 3. ニュース

### 3.1 対象ファイル

- `news/page.tsx`
- `news/[id]/NewsDetailClient.tsx`
- `news/actions.ts`

### 3.2 主な問題点・リファクタリング推奨理由

#### a. 記事一覧・ページネーション・タグ管理ロジックの肥大化

- **現状**：状態管理・UI 描画・イベントハンドラが密結合。
- **理由**：保守性・テスト容易性・UX の低下。
- **改善案**：
  - ロジック分離・UI 部品共通化。

#### b. 記事詳細・関連記事管理ロジックの肥大化

- **現状**：props/型の一貫性不足、UI 部品の重複。
- **理由**：UI 一貫性・保守性の低下。
- **改善案**：
  - ロジック分離・UI 部品共通化。

#### c. サーバーアクションの重複

- **現状**：記事/カテゴリ/タグ/サイドバー/関連記事取得の CRUD ロジックが他アクションと重複。エラーハ
  ンドリングの粒度不足。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 4. メッセージ

### 4.1 対象ファイル

- `message/page.tsx`

### 4.2 主な問題点・リファクタリング推奨理由

#### a. メッセージルーム・スピナー・データ取得ロジックの肥大化

- **現状**：状態管理・UI 描画・イベントハンドラが密結合。props/型の一貫性不足。
- **理由**：保守性・テスト容易性の低下。
- **改善案**：
  - ロジック分離・型の一元化。

---

## 5. タスク

### 5.1 対象ファイル

- `task/TaskList.tsx`
- `task/page.tsx`

### 5.2 主な問題点・リファクタリング推奨理由

#### a. タスクデータ・新着/未読メッセージ判定・UI 描画ロジックの肥大化

- **現状**：状態管理・UI 描画・イベントハンドラが密結合。props/型の一貫性不足、UI 部品の重複。
- **理由**：保守性・テスト容易性・UX の低下。
- **改善案**：
  - ロジック分離・UI 部品共通化。

#### b. タスクデータ取得・型定義の重複

- **現状**：サーバー側データ取得・型定義が重複。
- **理由**：保守性・堅牢性の低下。
- **改善案**：
  - データ取得ロジックの共通化。

---

## 6. 設定

### 6.1 対象ファイル

- `setting/page.tsx`
- `setting/notification/page.tsx` / `setting/scout/page.tsx` / `setting/mail/page.tsx` /
  `setting/ng-company/page.tsx` / `setting/password/page.tsx` / `setting/withdrawal/page.tsx`
- `setting/notification/actions.ts` / `setting/scout/actions.ts` / `setting/mail/actions.ts` /
  `setting/ng-company/actions.ts` / `setting/password/actions.ts` /
  `setting/withdrawal/reason/actions.ts`

### 6.2 主な問題点・リファクタリング推奨理由

#### a. 設定項目一覧・データ取得・UI 描画ロジックの肥大化

- **現状**：状態管理・UI 描画・イベントハンドラが密結合。props/型の一貫性不足。
- **理由**：保守性・拡張性・テスト容易性の低下。
- **改善案**：
  - ロジック分離・型の一元化。

#### b. 各設定項目のフォーム/バリデーション/保存/キャンセル/データ取得ロジックの重複

- **現状**：UI 部品の重複、props/型の一貫性不足。
- **理由**：UI 一貫性・保守性の低下。
- **改善案**：
  - フォームロジック・UI 部品・型の共通化。

#### c. サーバーアクションの重複

- **現状**：CRUD ロジック・エラーハンドリングが他アクションと重複。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 7. 横断的な改善方針

- **状態管理/アクション/バリデーション/エラー表示/型/UI 部品/CRUD 操作の共通化・一貫性強化**
- **カスタムフック化・ロジック共通化**
- **UI 部品の props/型/スタイル統一・共通化**
- **アクセシビリティ・UI/UX 一貫性の強化**

---

**（独り言）** この第 5 部では、メディア・ニュース・メッセージ・タスク・設定カテゴリの「どこを・なぜ
・どう直すべきか」を徹底的に具体化しました。 **次は layout/共通部品/サーバーアクション/横断的観点・
優先度・推奨戦略のまとめに進みます。**
