# candidate 配下リファクタリング診断・設計書（第 6 部：layout/共通部品/サーバーアクション/横断的観点・優先度・推奨戦略）

---

## 1. カテゴリ概要

この部では、`/candidate/layout.tsx`・共通 UI 部品・全アクションファイル・横断的な型/バリデーション/
ロジック/設計観点について、**リファクタリング必須箇所・優先度・推奨戦略**を厳密に記述します。

---

## 2. layout/共通部品

### 2.1 対象ファイル

- `layout.tsx`（および `CandidateLayout*`、`PageLayout`、`SectionCard`、`FormRow`、`EditButton` など
  ）

### 2.2 主な問題点・リファクタリング推奨理由

#### a. レイアウト/共通 UI 部品の props・型・スタイルの一貫性不足

- **現状**：props や型、スタイルの統一が不十分。責務分離が曖昧。
- **理由**：UI 一貫性・保守性・拡張性の低下。
- **改善案**：
  - props/型の統一・責務分離・共通部品化。
  - Next.js App Router の root layout 設計ベストプラクティス（公式ドキュメント参照）に準拠。

#### b. UI 部品の重複実装

- **現状**：PC/SP やページごとに同じような部品が複数存在。
- **理由**：保守性・拡張性の低下。
- **改善案**：
  - 共通 UI 部品の抽出・再利用。

---

## 3. サーバーアクション/データ取得

### 3.1 対象ファイル

- `actions.ts`全般

### 3.2 主な問題点・リファクタリング推奨理由

#### a. FormData→ 型変換/JSON パース/CRUD/エラーハンドリングの重複

- **現状**：全アクションで同様の処理が重複。
- **理由**：堅牢性・保守性・テスト容易性の低下。
- **改善案**：
  - 共通ユーティリティ化（型変換/CRUD/エラー処理/ロギング）。

#### b. Supabase 操作のパターン化不足

- **現状**：update→ なければ insert 等のパターンが各所でバラバラ。
- **理由**：保守性・堅牢性の低下。
- **改善案**：
  - パターン化・共通化。

#### c. 型安全性・エラー粒度・ロギングの一貫性不足

- **現状**：型安全性やエラー粒度、ロギング方法が統一されていない。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 型・エラー・ロギングの一元管理。

---

## 4. 型定義/バリデーション/ユーティリティ

### 4.1 問題点・リファクタリング推奨理由

#### a. zod スキーマ・TypeScript 型・バリデーションロジックの分散・重複

- **現状**：各ページ/アクションで分散・重複。
- **理由**：型安全性・保守性・テスト容易性の低下。
- **改善案**：
  - 型・バリデーションの共通化/一元化。

---

## 5. 状態管理/カスタムフック

### 5.1 問題点・リファクタリング推奨理由

#### a. useForm/useState/useEffect/モーダル管理/選択肢管理などのロジック重複

- **現状**：各ページで重複。
- **理由**：保守性・テスト容易性の低下。
- **改善案**：
  - カスタムフック化・ロジック共通化。

---

## 6. UI/UX/アクセシビリティ

### 6.1 問題点・リファクタリング推奨理由

#### a. エラー表示/バリデーション/フィードバック/ローディング UI の一貫性不足

- **現状**：一貫性が弱い。
- **理由**：UX・アクセシビリティの低下。
- **改善案**：
  - UI/UX/アクセシビリティの統一・改善。

---

## 7. 横断的な優先度・推奨戦略

### 7.1 優先度高

- 型定義・バリデーション・CRUD・エラー処理の共通化/一元化
- フォーム/編集/保存/初期化/モーダル管理のロジック共通化
- UI 部品の props/型/スタイル統一・共通化
- サーバーアクションの共通ユーティリティ化
- レイアウト/共通部品の責務分離・一貫性強化

### 7.2 優先度中

- カスタムフック化（状態管理/選択肢管理/データ取得/バリデーション等）
- ローディング/エラー/フィードバック UI の統一
- アクセシビリティ改善

### 7.3 優先度低

- パフォーマンス最適化（メモ化/キャッシュ/遅延ロード等）
- テストコードの充実

---

## 8. Next.js 最新ベストプラクティス参考

- App Router/Server Actions/Partial Rendering/Soft Navigation/Router Cache の活用
- 型安全性・アクセシビリティ・パフォーマンス・SEO の強化
- サーバー/クライアントコンポーネントの適切な分離
- 公式ドキュメント
  （[Next.js App Router Layout 設計](https://nextjs.org/docs/app/building-your-application/upgrading/from-vite)
  など）を参照

---

**（独り言）** この第 6 部では、横断的なリファクタリング観点・優先度・推奨戦略を厳密にまとめました。
**次は全体まとめ・推進計画例（第 7 部）に進みます。**
