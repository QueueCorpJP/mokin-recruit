# candidate 配下リファクタリング診断・設計書（第 2 部：プロフィール・学歴・職務要約）

---

## 【現状の進捗・実施済み内容】

- [x] プロフィール編集用の共通 zod スキーマ・型定義（`_shared/schemas/profileSchema.ts`）新規作成・
      全体適用
- [x] 学歴編集用の共通 zod スキーマ・型定義（`_shared/schemas/educationSchema.ts`）新規作成・全体適
      用
- [x] 職務要約用の共通 zod スキーマ・型定義（`_shared/schemas/summarySchema.ts`）新規作成・全体適用
- [x] 各フォームで共通スキーマ・型を useForm 等に適用し、バリデーション・型安全性を強化
- [x] 共通エラー表示部品（`_shared/fields/FormErrorMessage.tsx`）新規作成・全フォーム適用
- [x] 共通 Field 部品（`_shared/fields/FormField.tsx`）新規作成・一部フォームに適用（hideLabel 対応
      済み）
- [x] サーバーアクション共通バリデーションユーティリティ
      （`_shared/actions/validateFormDataWithZod.ts`）新規作成・全フォーム適用
- [x] サーバーアクション返却値の共通化（{ success, errors, message }）
- [x] 各フォームのバリデーション・エラー表示・型安全性・アクセシビリティを大幅強化
- [x] 既存 UI/UX・レイアウトを壊さず、段階的に共通化・リファクタリングを実施

---

## 【今後の TODO・残タスク】

- [ ] 共通 Field 部品（`_shared/fields/FormField.tsx`）の全フォーム適用・props 設計/型の完全統一
  - ※ summary フォームは適用済み、profile/education フォームは未適用 or 一部適用。既存レイアウト・UI
    を壊さないよう慎重に進める必要あり
- [ ] カスタムフック（`_shared/hooks/`）の新規作成・フォームロジック共通化
  - ※ useProfileForm, useEducationForm, useSummaryForm 等。現状は未着手
- [ ] 共通モーダル管理・ナビゲーションフック/ユーティリティの新設・適用
  - ※ モーダル開閉・router.push 等の重複ロジックの共通化。現状は未着手
- [ ] UI 部品（Section, FormRow, ActionButton 等）の props/型の一貫性強化・共通化
  - ※ 一部未着手。既存 UI/UX を壊さず段階的に進める
- [ ] テスト・ビルド・ロールバック体制の整備
  - [ ] 各カテゴリ・共通部品の単体/結合テストコード新規作成
  - [ ] CI/CD 連携による自動ビルド・型チェック・テスト・エラー通知体制の導入
  - [ ] 重大な不具合発生時のロールバック手順・feature flag 等の安全策を設計・実装
- [ ] 各段階でテスト・ビルド・動作確認、問題があれば即座に元に戻せる状態を維持

---

### 【補足・現状コメント】

- 型・バリデーション・エラー表示・サーバーアクションの共通化は全体で完了し、現代的な型安全・保守性・
  アクセシビリティの高い構成に進化。
- UI 部品の props 設計・カスタムフック・モーダル管理・テスト自動化等は今後の重点タスク。
- 既存 UI/UX・レイアウトを壊さず、段階的に共通化・リファクタリングを進める方針。
- 各タスクの進捗・完了状況は随時チェックリストで管理し、未着手・進行中のものにはコメントを付与。

---

## 1. カテゴリ概要

この部では
、`/candidate/account/profile/`・`/candidate/account/education/`・`/candidate/account/summary/`配下
の**プロフィール・学歴・職務要約**に関する全ページ・ロジックを徹底的に精査し、**リファクタリング必須
箇所とその理由・改善案**を厳密に記述します。

---

## 2. プロフィール編集・表示

### 2.1 対象ファイル

- `profile/EditButton.tsx`
- `profile/ProfileClient.tsx`
- `profile/edit/ProfileEditForm.tsx`
- `profile/edit/ProfileEditDesktop.tsx`
- `profile/edit/ProfileEditMobile.tsx`
- `profile/edit/ProfileEditClientWrapper.tsx`
- `profile/edit/fields/`配下（NameField, FuriganaField, GenderSelector, PrefectureSelect,
  IncomeSelect, PhoneNumberInput, BirthDateSelector など）
- `profile/edit/actions.ts`

### 2.2 主な問題点・リファクタリング推奨理由

#### a. 型・バリデーション・初期値管理の分散

- **現状**：zod スキーマや TypeScript 型、初期値ロジックが各ファイル・各フィールドで分散し、再利用性
  ・一貫性が低い。
- **理由**：型安全性・保守性・テスト容易性の低下。
- **改善案**：
  - 共通型・zod スキーマを`/types`や`/schemas`等で一元管理。
  - 初期値生成ロジックも共通化。

#### b. UI 部品・フィールドの重複・props 肥大化

- **現状**：NameField, FuriganaField, GenderSelector, ... などのフィールド部品が個別実装されているが
  、props や型の一貫性が弱い。PC/SP で同じフィールドが重複実装。
- **理由**：保守性・拡張性・UI 一貫性の低下。
- **改善案**：
  - 共通 Field 型・エラー表示部品の導入。
  - PC/SP でレイアウトのみ分離し、フィールド部品は共通化。

#### c. バリデーションエラー表示の一貫性不足

- **現状**：バリデーションエラーの表示方法がフィールドごとに異なる。
- **理由**：UX・アクセシビリティの低下。
- **改善案**：
  - 共通エラー表示部品の導入。

#### d. useForm/useEffect/状態管理の重複

- **現状**：初期値設定やキャンセル処理、状態管理が各ファイルで重複。
- **理由**：保守性・テスト容易性の低下。
- **改善案**：
  - カスタムフック化（useProfileForm 等）。

#### e. ルーティング/イベントハンドラの重複

- **現状**：router.push 等のロジックが各所に分散。
- **理由**：保守性・一貫性の低下。
- **改善案**：
  - 共通ナビゲーションフック/ユーティリティ化。

#### f. サーバーアクションの重複

- **現状**：FormData→ 型変換/CRUD/エラー処理が他アクションと重複。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 3. 学歴・経験業種/職種編集

### 3.1 対象ファイル

- `education/edit/EducationEditForm.tsx`
- `education/edit/actions.ts`

### 3.2 主な問題点・リファクタリング推奨理由

#### a. 業種・職種選択/年数管理ロジックの重複

- **現状**：業種・職種の選択や年数管理ロジックが複数箇所で重複。
- **理由**：保守性・拡張性・テスト容易性の低下。
- **改善案**：
  - 業種/職種選択ロジックの共通化（カスタムフック化）。

#### b. バリデーション/型定義の分散

- **現状**：zod スキーマと TypeScript 型が混在。
- **理由**：型安全性・保守性の低下。
- **改善案**：
  - 型・バリデーションの一元化。

#### c. モーダル管理の重複

- **現状**：IndustrySelectModal, JobTypeSelectModal の開閉・初期値ロジックが煩雑。
- **理由**：保守性・拡張性の低下。
- **改善案**：
  - モーダル管理ロジックの共通化。

#### d. API 連携（保存/取得）が未実装 or 仮実装

- **現状**：TODO コメントが多い。
- **理由**：実装漏れ・仕様不明確。
- **改善案**：
  - API 設計・実装の明確化。

#### e. サーバーアクションの重複

- **現状**：FormData→ 型変換/CRUD/エラー処理が他アクションと重複。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 4. 職務要約編集

### 4.1 対象ファイル

- `summary/edit/page.tsx`
- `summary/edit/actions.ts`

### 4.2 主な問題点・リファクタリング推奨理由

#### a. フォームロジック・バリデーション・初期化の重複

- **現状**：zod スキーマ、useForm、onSubmit、handleCancel 等が他編集ページと重複。
- **理由**：保守性・テスト容易性の低下。
- **改善案**：
  - フォームロジックの共通化。
  - 初期化/リセットの共通フック化。

#### b. サーバーアクションの重複

- **現状**：FormData→ 型変換/CRUD/エラー処理が他アクションと重複。
- **理由**：堅牢性・保守性の低下。
- **改善案**：
  - 共通アクションユーティリティ化。

---

## 5. 横断的な改善方針

- **型・バリデーション・エラー表示・初期化・保存・モーダル管理・CRUD 操作の共通化/一元化**
- **UI 部品（Section, FormRow, ActionButton 等）の props や型の一貫性強化・共通化**
- **カスタムフック化・ロジック共通化**
- **アクセシビリティ・UI/UX 一貫性の強化**
