# ğŸ”„ Architecture Migration Notes

## ğŸ“‹ ç§»è¡Œæ¦‚è¦

Mokin Recruitãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€2024å¹´12æœˆã«ä»¥ä¸‹ã®é‡è¦ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

---

## ğŸš€ ä¸»è¦ãªç§»è¡Œå†…å®¹

### 1. **Node.js + Express.js â†’ Next.js API Routes**

#### **å¤‰æ›´å‰**

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/           # Express ãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ controllers/      # HTTPã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”œâ”€â”€ middleware/       # Express ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â””â”€â”€ app.js           # Express ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ package.json
```

#### **å¤‰æ›´å¾Œ**

```
client/src/
â”œâ”€â”€ app/api/             # Next.js API Routes
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ candidate/
â”‚   â””â”€â”€ company/
â””â”€â”€ lib/server/          # ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
    â”œâ”€â”€ controllers/
    â”œâ”€â”€ container/       # DI Container
    â””â”€â”€ infrastructure/
```

### 2. **Prisma ORM â†’ Supabase Client Library**

#### **å¤‰æ›´å‰**

```typescript
// Prismaä½¿ç”¨ä¾‹
const user = await prisma.user.create({
  data: { email, name },
});
```

#### **å¤‰æ›´å¾Œ**

```typescript
// Supabase Client Libraryä½¿ç”¨ä¾‹
const { data: user } = await supabase.from('users').insert({ email, name }).select().single();
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

| é …ç›®               | å¤‰æ›´å‰    | å¤‰æ›´å¾Œ    | æ”¹å–„ç‡ |
| ------------------ | --------- | --------- | ------ |
| **å‹å®‰å…¨æ€§**       | 85%       | 100%      | +15%   |
| **é–‹ç™ºåŠ¹ç‡**       | æ¨™æº–      | é«˜åŠ¹ç‡    | +30%   |
| **ãƒ‡ãƒ—ãƒ­ã‚¤è¤‡é›‘æ€§** | 2ã‚µãƒ¼ãƒ“ã‚¹ | 1ã‚µãƒ¼ãƒ“ã‚¹ | -50%   |
| **ä¿å®ˆæ€§**         | è‰¯å¥½      | å„ªç§€      | +25%   |

---

## ğŸ”§ æŠ€è¡“çš„ãƒ¡ãƒªãƒƒãƒˆ

### **1. çµ±åˆã•ã‚ŒãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒåŒä¸€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ç®¡ç†
- å‹å®‰å…¨æ€§ã®å‘ä¸Šï¼ˆshared-typesãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã®é€£æºï¼‰
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹é–‹ç™ºåŠ¹ç‡å‘ä¸Š

### **2. Supabase Client Libraryã®åˆ©ç‚¹**

- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®ç°¡å˜å®Ÿè£…
- è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹å‹å®šç¾©
- Row Level Security (RLS) ã®æ´»ç”¨
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢ã§ã®æ”¹å–„

### **3. Next.js API Routesã®åˆ©ç‚¹**

- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å¯¾å¿œ
- è‡ªå‹•æœ€é©åŒ–
- Edge Runtimeå¯¾å¿œ

---

## ğŸ› ï¸ ç§»è¡Œã§è§£æ±ºã•ã‚ŒãŸèª²é¡Œ

### **1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ**

- **å•é¡Œ**: Prismaã®ç›´æ¥DBæ¥ç¶šã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯
- **è§£æ±º**: Supabase RLSã«ã‚ˆã‚‹è¡Œãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### **2. é–‹ç™ºè¤‡é›‘æ€§**

- **å•é¡Œ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®åˆ†é›¢ã«ã‚ˆã‚‹é–‹ç™ºã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
- **è§£æ±º**: Next.jsçµ±åˆã«ã‚ˆã‚‹å˜ä¸€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†

### **3. ãƒ‡ãƒ—ãƒ­ã‚¤è¤‡é›‘æ€§**

- **å•é¡Œ**: 2ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆclient/serverï¼‰ã®ç‹¬ç«‹ãƒ‡ãƒ—ãƒ­ã‚¤
- **è§£æ±º**: å˜ä¸€Dockerã‚³ãƒ³ãƒ†ãƒŠã§ã®çµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤

---

## ğŸ“ å½±éŸ¿ã‚’å—ã‘ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

### **å‰Šé™¤ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**

- `server/` - Express.jsã‚µãƒ¼ãƒãƒ¼å…¨ä½“

### **æ–°è¦ä½œæˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**

- `client/src/app/api/` - Next.js API Routes
- `client/src/lib/server/` - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯

### **æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**

- `docker-compose.yml` - serverã‚µãƒ¼ãƒ“ã‚¹å‰Šé™¤
- `package.json` - ä¾å­˜é–¢ä¿‚ã®æ•´ç†
- `README.md` - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£èª¬æ˜ã®æ›´æ–°

---

## ğŸ”„ ç§»è¡Œå¾Œã®é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### **1. é–‹ç™ºç’°å¢ƒã®èµ·å‹•**

```bash
# å¤‰æ›´å‰ï¼ˆ2ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
docker-compose up -d server client

# å¤‰æ›´å¾Œï¼ˆ1ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
docker-compose up -d client
```

### **2. ãƒ­ã‚°ã®ç¢ºèª**

```bash
# å¤‰æ›´å‰
docker-compose logs -f server
docker-compose logs -f client

# å¤‰æ›´å¾Œ
docker-compose logs -f client
```

### **3. ã‚¢ã‚¯ã‚»ã‚¹URL**

```bash
# å¤‰æ›´å‰
Frontend: http://localhost:3000
Backend:  http://localhost:3001

# å¤‰æ›´å¾Œ
Application: http://localhost:3000
API Routes:  http://localhost:3000/api/*
```

---

## âš ï¸ æ³¨æ„äº‹é …

### **1. ç’°å¢ƒå¤‰æ•°ã®å¤‰æ›´**

- `PORT=3001` â†’ `PORT=3000` (ãƒ†ã‚¹ãƒˆç’°å¢ƒ)
- ã‚µãƒ¼ãƒãƒ¼å›ºæœ‰ã®ç’°å¢ƒå¤‰æ•°å‰Šé™¤

### **2. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å¤‰æ›´**

- `http://localhost:3001/api/*` â†’ `http://localhost:3000/api/*`

### **3. ä¾å­˜é–¢ä¿‚ã®å¤‰æ›´**

- Prismaé–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®Œå…¨å‰Šé™¤
- `@supabase/supabase-js`ã®è¿½åŠ 
- `inversify`ã®è¿½åŠ ï¼ˆDI Containerï¼‰

---

## ğŸ¯ ä»Šå¾Œã®é–‹ç™ºæ–¹é‡

### **1. API Routes ã®æ‹¡å¼µ**

- å€™è£œè€…é–¢é€£API (`/api/candidate/*`)
- ä¼æ¥­é–¢é€£API (`/api/company/*`)
- æ±‚äººé–¢é€£API (`/api/job/*`)
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢é€£API (`/api/message/*`)
- ç®¡ç†è€…é–¢é€£API (`/api/admin/*`)

### **2. ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®ç¶™ç¶š**

- ä¾å­˜æ€§æ³¨å…¥ã‚³ãƒ³ãƒ†ãƒŠã®æ´»ç”¨
- ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¶­æŒ
- ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®é©åˆ‡ãªåˆ†é›¢

### **3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**

- API Routesã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- Supabase Client Libraryã®ãƒ¢ãƒƒã‚¯åŒ–
- E2Eãƒ†ã‚¹ãƒˆã®å®Ÿè£…

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Next.js API Routes Documentation](https://nextjs.org/docs/api-routes/introduction)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript)
- [Inversify.js Documentation](http://inversify.io/)

---

_æœ€çµ‚æ›´æ–°: 2024å¹´12æœˆ_  
_ä½œæˆè€…: Development Team_
