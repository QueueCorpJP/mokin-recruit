# Mokin Recruit - QA依頼観点（外部機関用）

## プロジェクト概要

**転職プラットフォーム「Mokin Recruit」** - 候補者（求職者）、企業、管理者向けの総合的な転職支援システム

### 技術スタック
- **フロントエンド**: Next.js 15 + React 19 + TypeScript + Tailwind CSS v4
- **バックエンド**: Next.js API Routes + Supabase (PostgreSQL)
- **認証**: Supabase Auth + JWT + Row Level Security (RLS)
- **状態管理**: Zustand + React Query
- **バリデーション**: Zod schema validation

## 機能テスト観点

### 1. 候補者機能テスト

#### 1.1 会員登録・認証フロー
- **正常系**:
  - メールアドレス + 4桁認証コード登録フロー
  - パスワード設定・変更・再設定
  - 12ステップの詳細プロフィール登録
  - レジュメ（PDF）アップロード機能
- **異常系**:
  - 無効なメールアドレス形式
  - 認証コード期限切れ・誤入力
  - 重複メールアドレス登録防止
  - ファイルサイズ・形式制限（PDFのみ、最大5MB）

#### 1.2 求人検索・応募機能
- **検索条件**: 職種、業種、勤務地、年収、リモートワーク可否
- **並び替え**: 新着順、更新順、マッチ度順
- **応募フロー**: 必要書類確認 → 応募確定 → 自動メッセージ送信
- **お気に入り機能**: 登録・解除・一覧表示

#### 1.3 スカウト・メッセージ機能
- **スカウト受信**: 企業からのスカウト表示・辞退機能
- **メッセージ送受信**: テキスト + ファイル添付
- **辞退理由選択**: 8つの定型理由から選択
- **未読バッジ表示**: リアルタイム更新

### 2. 企業機能テスト

#### 2.1 企業アカウント・グループ管理
- **企業グループ作成**: 複数グループ管理機能
- **メンバー招待**: メール招待 → アカウント作成フロー
- **権限管理**: スカウト担当者 vs 管理者権限
- **休会ステータス**: 機能制限の適切な動作

#### 2.2 求人管理
- **求人作成**: 15以上の必須・任意項目入力
- **掲載申請フロー**: 作成 → 運営審査 → 承認/非承認
- **公開範囲設定**: 完全公開、一部公開、限定公開、公開停止
- **求人複製機能**: 既存求人からの複製作成

#### 2.3 候補者検索・スカウト
- **高度検索**: 20以上の検索条件組み合わせ
- **ブーリアン検索**: AND/OR/NOT演算子対応
- **スカウトチケット**: 月次付与・消費・期限管理
- **テンプレート機能**: 関数呼び出し（候補者名、企業名等の動的挿入）

### 3. 管理者機能テスト

#### 3.1 全体管理機能
- **ユーザー管理**: 候補者・企業アカウントの一括管理
- **CSVダウンロード**: 大量データの一括出力
- **求人審査**: 掲載申請の承認・非承認・保留処理
- **コンテンツ管理**: メディア記事・お知らせ作成

#### 3.2 メッセージ監視・審査
- **NGワード検出**: 自動検出 → 手動審査フロー
- **メッセージ審査**: 承認・却下・理由通知
- **初回承認後の自動承認**: 同一ペアでの2回目以降

## セキュリティテスト観点

### 1. 認証・認可テスト

#### 1.1 Supabase Auth + RLS
- **JWT署名検証**: トークンの改ざん検知
- **Row Level Security**: テーブルレベルのアクセス制御
  ```sql
  -- 候補者は自分のデータのみアクセス可能
  CREATE POLICY "candidates_own_data" ON candidates 
  FOR ALL USING (auth.uid() = id);
  
  -- 企業は承認された候補者のみ閲覧可能
  CREATE POLICY "companies_approved_candidates" ON candidates
  FOR SELECT USING (/* 複雑な認可ロジック */);
  ```

#### 1.2 ロールベースアクセス制御
- **候補者**: 自己データのみアクセス
- **企業スカウト担当**: グループ内データのみ
- **企業管理者**: グループ管理権限
- **システム管理者**: 全データアクセス

#### 1.3 セッション管理
- **HttpOnly/Secure Cookie**: XSS攻撃対策
- **セッションタイムアウト**: 24時間自動無効化
- **リフレッシュトークン**: 30日間ローテーション

### 2. 脆弱性対策テスト

#### 2.1 XSS (Cross-Site Scripting)
- **入力値エスケープ**: 全ユーザー入力のサニタイズ
- **DOMPurify**: リッチテキストコンテンツの無害化
- **CSP (Content Security Policy)**: インラインスクリプト制限

#### 2.2 CSRF (Cross-Site Request Forgery)
- **CSRFトークン**: 全フォームでのトークン検証
- **SameSite Cookie**: CSRF攻撃の追加防御
- **Origin/Refererヘッダー検証**: API呼び出し元の確認

#### 2.3 SQLインジェクション
- **Supabase Client**: プリペアドステートメント強制
- **Zodバリデーション**: API入力値の型・形式検証
- **パラメータ化クエリ**: 動的SQL構築の回避

### 3. データ保護テスト

#### 3.1 個人情報保護
- **氏名・電話番号**: 応募/スカウト返信まで企業に非表示
- **パスワードハッシュ化**: bcrypt強力アルゴリズム
- **退会データ保持**: 9ヶ月後の自動削除

#### 3.2 企業情報保護
- **ブロック機能**: 特定企業からの候補者情報アクセス制限
- **選考状況同意**: 他社への開示可否の明示的確認
- **社内メモ**: 候補者・他企業への非公開

## パフォーマンステスト観点

### 1. 大量データ処理

#### 1.1 候補者検索
- **同時検索**: 100企業ユーザーでの並行検索
- **複雑条件**: 20項目組み合わせでの検索レスポンス
- **結果ページング**: 10,000件以上のデータでのページ処理

#### 1.2 メッセージ処理
- **リアルタイムメッセージ**: WebSocket接続での大量同時送受信
- **ファイル添付**: 最大5MBファイルの並行アップロード
- **未読バッジ更新**: 1,000通以上の未読メッセージでのUI更新

### 2. 高負荷状況テスト

#### 2.1 同時アクセス
- **ピーク時想定**: 1,000ユーザー同時ログイン
- **スカウト送信**: 100企業での同時スカウト大量送信
- **CSV大量ダウンロード**: 管理者による10万件データ出力

#### 2.2 メモリ・リソース監視
- **Next.js Memory Leak**: 長時間稼働でのメモリ使用量
- **React State Management**: Zustand/React Queryでの状態管理
- **Supabase Connection Pool**: データベース接続数の適切な管理

### 3. レスポンシブ・UX

#### 3.1 画面サイズ対応
- **モバイルファースト**: 320px～1920px対応
- **Tailwind CSS**: ブレークポイント別レイアウト
- **タッチ操作**: スマートフォンでのフォーム入力・ファイル選択

#### 3.2 アクセシビリティ
- **キーボードナビゲーション**: Tab順序・フォーカス管理
- **スクリーンリーダー**: 適切なARIA属性・セマンティックHTML
- **色覚サポート**: カラーコントラスト・色以外の情報伝達

## 互換性テスト観点

### 1. ブラウザ対応
- **Modern Browsers**: Chrome 120+, Safari 17+, Firefox 120+, Edge 120+
- **JavaScript有効**: Next.js SSR/CSRハイブリッド
- **Cookie/LocalStorage**: 認証状態・設定の永続化

### 2. デバイス対応
- **レスポンシブ**: PC、タブレット、スマートフォン
- **ファイルアップロード**: 各デバイスでのPDFファイル選択・アップロード
- **プッシュ通知**: ブラウザ通知API（オプション）

## データ整合性テスト観点

### 1. トランザクション制御
- **応募処理**: 候補者応募 → メッセージボックス作成の原子性
- **スカウト送信**: チケット消費 → メッセージ送信の整合性
- **権限変更**: 企業グループ権限変更の即座反映

### 2. リアルタイム同期
- **同時編集**: 複数管理者による同一データ編集
- **メッセージ同期**: 送受信者間でのリアルタイム表示
- **通知更新**: 未読カウント・バッジの即座更新

## 運用テスト観点

### 1. エラーハンドリング
- **Supabase接続エラー**: DB接続断での適切なエラー表示
- **外部API障害**: 学校名・企業名APIでの代替処理
- **ファイルアップロード失敗**: 大容量・不正形式での適切なエラー処理

### 2. ログ・監査
- **操作ログ**: 全ユーザー行動の記録・追跡
- **エラーログ**: Winston.jsでの構造化ログ出力
- **セキュリティログ**: 不正アクセス・権限昇格試行の検知

### 3. バックアップ・復旧
- **データバックアップ**: Supabaseでの定期バックアップ
- **障害復旧**: サービス中断時の復旧手順
- **データ移行**: 大規模アップデート時のデータマイグレーション